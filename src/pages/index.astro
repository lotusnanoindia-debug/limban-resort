---
import Layout from "../layouts/Layout.astro";
import { AstroSEO } from "astro-seo-plugin";
import HeroSection from "../components/IndexHero.astro";
import SubHeroSection from "../components/SubHeroSection.astro";
import RoomsSection from "../components/RoomsSection.astro";
import ExperiencesSection from "../components/ExperiencesSection.astro";
import TestimonialsSection from "../components/TestimonialsSection.astro";
import AwardsSection from "../components/AwardsSection.astro";
import ContactSection from "../components/ContactSection.astro";
import { fetchHomepageData } from "../api.js";

// Fetch data using clean API function
const data = await fetchHomepageData();

const heroes =
  data.heroes?.map((hero) => ({
    ...hero,
    heroImage: {
      url: hero.backgroundImage?.url,
      alt:
        hero.backgroundImage?.alt ||
        `${hero.slideTitle} - Limban Resort luxury safari experience`,
    },
  })) || [];

const rooms =
  data.rooms?.map((room) => ({
    ...room,
    roomImage: {
      url: room.heroImage?.url,
      alt: room.heroImage?.alt || room.roomName,
      altText: room.heroImage?.alt || room.roomName,
    },
    heroImage: {
      url: room.heroImage?.url,
      alt: room.heroImage?.alt || room.roomName,
    },
  })) || [];

// Safe hero image for SEO
const heroImage =
  heroes[0]?.heroImage?.url ||
  "https://limban.com/img/limban-hero-fallback.avif";

// Data for amenities to keep the JSON-LD clean
const amenities = [
  "Tiger Safari Tours",
  "Eco-Luxury Accommodations",
  "Wildlife Conservation Programs",
  "Spa & Wellness Center",
  "Restaurant & Bar",
  "Swimming Pool",
  "Free WiFi",
  "Airport Transfer",
];

// JSON-LD schema (keep exactly the same)
const enhancedJsonLd = {
  "@context": "https://schema.org",
  "@type": "Resort",
  "@id": "https://limban.com",
  name: "Limban Resort",
  description:
    "Award-winning eco-luxury safari resort in Tadoba National Park offering sustainable tiger safaris, wellness programs, and conservation-focused hospitality in Maharashtra, India",
  url: "https://limban.com",
  logo: {
    "@type": "ImageObject",
    url: "https://limban.com/img/limban-resort-tadoba-logo.png",
    width: 300,
    height: 100,
  },
  image: [
    heroImage,
    ...rooms
      .slice(0, 3)
      .map((room) => room.heroImage?.url)
      .filter(Boolean),
    // Note: Experience images are now handled within the component
    // and can be added back here if needed for top-level SEO.
  ].filter(Boolean),
  sameAs: [
    "https://www.tripadvisor.in/Hotel_Review-g10594630-d12902646-Reviews-Limban_Resort-Chandrapur_District_Maharashtra.html",
    "https://www.instagram.com/limbanresorts/",
    "https://www.facebook.com/limbanresortstadoba/",
  ],
  address: {
    "@type": "PostalAddress",
    streetAddress: "Survey No. 306, Village Mudholi, Taluka Bhadravati",
    addressLocality: "Chandrapur",
    addressRegion: "Maharashtra",
    postalCode: "442906",
    addressCountry: "IN",
  },
  geo: {
    "@type": "GeoCoordinates",
    latitude: 20.25602486093492,
    longitude: 79.2847888101826,
  },
  telephone: ["+91-90226-80451"],
  email: "info@limban.com",
  priceRange: "₹15,000-₹45,000",
  currenciesAccepted: ["INR"],
  paymentAccepted: ["Cash", "Credit Card", "UPI", "Bank Transfer"],
  checkinTime: "13:00",
  checkoutTime: "11:00",
  numberOfRooms: 16,
  petsAllowed: true,
  smokingAllowed: false,
  starRating: {
    "@type": "Rating",
    ratingValue: 5,
  },
  aggregateRating: {
    "@type": "AggregateRating",
    ratingValue: 4.8,
    reviewCount: 327,
    bestRating: 5,
    worstRating: 4,
  },
  amenityFeature: amenities.map((name) => ({
    "@type": "LocationFeatureSpecification",
    name: name,
    value: true,
  })),
  makesOffer: [
    {
      "@type": "Offer",
      name: "Safari Package",
      description: "Tiger safari experience with luxury accommodations",
    },
  ],
  hasMap:
    "https://www.google.com/maps/place/20.25602486093492,79.2847888101826",
  award: [
    "TripAdvisor Travelers' Choice 2023",
    "Condé Nast Traveller Featured Property",
    "Outlook Traveller Hidden Gem 2022",
  ],
  knowsAbout: [
    "Tiger Conservation",
    "Sustainable Tourism",
    "Wildlife Photography",
    "Eco-Luxury Hospitality",
    "Tadoba Ecosystem",
  ],
};
---

<Layout>
  <AstroSEO
    slot="head"
    title="Limban Resort | Award-Winning Eco-Luxury Tiger Safari Lodge in Tadoba National Park"
    description="Experience sustainable luxury at Limban Resort, Tadoba's premier eco-friendly safari lodge. Award-winning tiger safaris, conservation programmes, and luxury accommodations in Maharashtra, India."
    canonical="https://limban.com"
    openGraph={{
      title:
        "Limban Resort - Award-Winning Eco-Luxury Safari Lodge | Tadoba National Park",
      description:
        "Discover India's premier eco-luxury safari experience at Limban Resort. Sustainable tiger safaris, conservation programmes, and award-winning hospitality in Tadoba National Park, Maharashtra.",
      image: heroImage,
      type: "website",
      url: "https://limban.com",
      site_name: "Limban Resort",
    }}
    jsonLd={enhancedJsonLd}
  />

  <HeroSection heroes={heroes} />
  <SubHeroSection subHero={data.subHero} />
  <RoomsSection rooms={rooms} specialDeal={data.specialDeal} />
  {data.services && <ExperiencesSection experiences={data.services} />}
  <TestimonialsSection />
  <AwardsSection />
  <ContactSection />
</Layout>
