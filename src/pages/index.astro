---
import Layout from '../layouts/Layout.astro';
import { AstroSEO } from 'astro-seo-plugin';
import HeroSection from '../components/HeroSection.astro';
import SubHeroSection from '../components/SubHeroSection.astro';
import RoomsSection from '../components/RoomsSection.astro';
import ExperiencesSection from '../components/ExperiencesSection.astro';
import TestimonialsSection from '../components/TestimonialsSection.astro';
import AwardsSection from '../components/AwardsSection.astro';
import ContactSection from '../components/ContactSection.astro';
import { fetchAllHomepageData } from '../api.js';

// Server-side data fetching (replaces React useState/useEffect)
let data = {
  heroes: [],
  subHero: null,
  rooms: [],
  experiences: null,
  specialDeal: null
};

let error = null;

try {
  data = await fetchAllHomepageData();
} catch (err) {
  console.error('Failed to load homepage data:', err);
  error = 'Failed to load content from Hygraph';
}

// Calculate grid layout for experiences
const experienceCount = data.experiences?.experience?.length || 0;
const gridClass = {
  1: 'grid-cols-1',
  2: 'grid-cols-1 md:grid-cols-2', 
  3: 'grid-cols-1 md:grid-cols-3',
  4: 'grid-cols-1 md:grid-cols-2'
}[experienceCount] || 'grid-cols-1 md:grid-cols-2';

// Dynamic hero image from CMS or fallback
const heroImage = data.heroes[0]?.backgroundImage?.url || '/img/tiger-safari-hero.jpg';
---

<Layout title="Limban Resort - Luxury Eco-Safari Experience in Tadoba">
  <AstroSEO
    title="Limban Resort | Luxury Eco-Friendly Safari & Wellness Retreat in Tadoba National Park"
    description="Discover unparalleled luxury and sustainability at Limban Resort, nestled in the heart of Tadoba National Park. Experience responsible tiger safaris, eco-conscious wellness programs, and authentic cultural immersion in Maharashtra, India."
    canonical="https://limban.com"
    openGraph={{
      title: "Limban Resort - Eco-Luxury Safari Retreat in Tadoba National Park",
      description: "Experience sustainable luxury at Limban Resort. Award-winning eco-friendly safari lodge offering responsible tiger experiences, wellness programs, and conservation-focused hospitality in Maharashtra, India.",
      image: heroImage,
      type: "website",
      url: "https://limban.com",
      site_name: "Limban Resort"
    }}
    jsonLd={{
      "@context": "https://schema.org",
      "@type": "Resort",
      "name": "Limban Resort",
      "description": "Luxury eco-friendly safari resort in Tadoba National Park offering sustainable tiger safaris, wellness programs, and conservation-focused hospitality in Maharashtra, India",
      "url": "https://limban.com",
      "logo": "https://limban.com/img/limban-logo.png",
      "image": heroImage,
      "sameAs": [
        "https://www.tripadvisor.in/Hotel_Review-g10594630-d12902646-Reviews-Limban_Resort-Chandrapur_District_Maharashtra.html",
        "https://www.instagram.com/limbanresorts/",
        "https://www.facebook.com/limbanresort"
      ],
      "hasMap": "https://www.google.com/maps/place/20.25602486093492,79.2847888101826",
      "checkinTime": "14:00",
      "checkoutTime": "12:00",
      "currenciesAccepted": "INR",
      "paymentAccepted": "Cash, Credit Card, UPI",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Chandrapur",
        "addressRegion": "Maharashtra",
        "addressCountry": "IN"
      },
      "telephone": "+91-90226-80451",
      "email": "info@limban.com",
      "priceRange": "₹₹₹₹",
      "amenityFeature": [
        {
          "@type": "LocationFeatureSpecification", 
          "name": "Sustainable Tiger Safari Tours",
          "value": true
        },
        {
          "@type": "LocationFeatureSpecification", 
          "name": "Eco-Friendly Luxury Accommodations",
          "value": true
        },
        {
          "@type": "LocationFeatureSpecification", 
          "name": "Wildlife Conservation Programs",
          "value": true
        },
        {
          "@type": "LocationFeatureSpecification", 
          "name": "Wellness & Spa Services",
          "value": true
        },
        {
          "@type": "LocationFeatureSpecification", 
          "name": "Carbon-Neutral Operations",
          "value": true
        },
        {
          "@type": "LocationFeatureSpecification", 
          "name": "Local Community Support",
          "value": true
        }
      ],
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": "20.2961",
        "longitude": "79.2961"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "reviewCount": "127",
        "bestRating": "5",
        "worstRating": "1"
      }
    }}
    additionalLinkTags={[
      // Professional favicon setup - all formats
      { 
        rel: "apple-touch-icon", 
        sizes: "180x180", 
        href: "/apple-touch-icon.png" 
      },
      { 
        rel: "icon", 
        type: "image/png", 
        sizes: "32x32", 
        href: "/favicon-32x32.png" 
      },
      { 
        rel: "icon", 
        type: "image/png", 
        sizes: "16x16", 
        href: "/favicon-16x16.png" 
      },
      { 
        rel: "manifest", 
        href: "/site.webmanifest" 
      },
      // Legacy support (prevents 404s)
      { 
        rel: "shortcut icon", 
        href: "/favicon.ico" 
      }
    ]}
    additionalMetaTags={[
      {
        name: "robots",
        content: "index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
      },
      {
        property: "og:locale",
        content: "en_IN"
      },
      {
        name: "theme-color",
        content: "#09090B"
      },
      {
        name: "msapplication-TileColor",
        content: "#09090B"
      },
      {
        name: "keywords",
        content: "luxury safari resort Tadoba, eco-friendly accommodation Maharashtra, tiger conservation resort India"
      },
      {
        name: "author",
        content: "Limban Resort"
      },
      { name: "geo.region", content: "IN-MH" },
      { name: "geo.placename", content: "Tadoba National Park, Chandrapur" },
      { name: "geo.position", content: "20.25602486093492;79.2847888101826" },
      { name: "ICBM", content: "20.25602486093492, 79.2847888101826" }
    ]}
  />
  
  {error ? (
    <div class="bg-gray-950 text-gray-100 h-screen flex items-center justify-center">
      <div class="text-center">
        <div class="text-2xl font-serif italic mb-4 text-red-400">Error Loading Content</div>
        <div class="text-gray-400">{error}</div>
        <div class="text-sm text-gray-500 mt-4">Please check your connection and try again</div>
      </div>
    </div>
  ) : (
    <div class="bg-gray-950 text-gray-100 font-sans antialiased selection:bg-gray-700">
      <!-- Hero Section with Safari Carousel -->
      <HeroSection heroes={data.heroes} />
      
      <!-- Sub Hero Section with Resort Introduction -->
      <SubHeroSection subHero={data.subHero} />
      
      <!-- Luxury Accommodations Section -->
      <RoomsSection rooms={data.rooms} specialDeal={data.specialDeal} />
      
      <!-- Safari & Wilderness Experiences -->
      <ExperiencesSection experiences={data.experiences} gridClass={gridClass} />
      
      <!-- Guest Testimonials -->
      <TestimonialsSection />
      
      <!-- Awards & Recognition -->
      <AwardsSection />
      
      <!-- Contact & Reservations -->
      <ContactSection />
    </div>
  )}
</Layout>
