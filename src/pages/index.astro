---
import Layout from "../layouts/Layout.astro";
import { AstroSEO } from "astro-seo-plugin";
import HeroSection from "../components/HeroSection.astro";
import SubHeroSection from "../components/SubHeroSection.astro";
import RoomsSection from "../components/RoomsSection.astro";
import ExperiencesSection from "../components/ExperiencesSection.astro";
import TestimonialsSection from "../components/TestimonialsSection.astro";
import AwardsSection from "../components/AwardsSection.astro";
import ContactSection from "../components/ContactSection.astro";

// ✅ CHANGE: Use optimized API for AVIF images
import { fetchAllHomepageDataOptimized } from "../api-optimized.js";

// Fetch data using optimized function
const data = await fetchAllHomepageDataOptimized();

const heroes =
  data.heroes?.map((hero) => ({
    ...hero,
    heroImage: {
      url: hero.backgroundImage?.url, // ✅ Use backgroundImage not heroImage
      alt:
        hero.backgroundImage?.altText ||
        `${hero.slideTitle} - Limban Resort luxury safari experience`,
    },
  })) || [];

const rooms =
  data.rooms?.map((room) => ({
    ...room,
    heroImage: {
      url: room.heroImage?.url,
      alt: room.heroImage?.altText || room.roomName,
    },
  })) || [];

const services =
  data.experiences?.experience?.map((exp) => ({
    ...exp,
    serviceImage: {
      url: exp.image?.url,
      alt: exp.image?.altText || exp.title,
    },
  })) || [];

// Safe hero image for SEO
const heroImage =
  heroes[0]?.heroImage?.url ||
  "https://limban.com/img/limban-hero-fallback.avif";

// JSON-LD schema (keep exactly the same)
const enhancedJsonLd = {
  "@context": "https://schema.org",
  "@type": "Resort",
  "@id": "https://limban.com/#resort",
  name: "Limban Resort",
  description:
    "Award-winning eco-luxury safari resort in Tadoba National Park offering sustainable tiger safaris, wellness programs, and conservation-focused hospitality in Maharashtra, India",
  url: "https://limban.com",
  logo: {
    "@type": "ImageObject",
    url: "https://limban.com/img/limban-resort-tadoba-logo.avif",
    width: 300,
    height: 100,
  },
  image: [
    heroImage,
    ...rooms
      .slice(0, 3)
      .map((room) => room.heroImage?.url)
      .filter(Boolean),
    ...services
      .slice(0, 2)
      .map((exp) => exp.serviceImage?.url)
      .filter(Boolean),
  ].filter(Boolean),
  sameAs: [
    "https://www.tripadvisor.in/Hotel_Review-g10594630-d12902646-Reviews-Limban_Resort-Chandrapur_District_Maharashtra.html",
    "https://www.instagram.com/limbanresorts/",
    "https://www.facebook.com/limbanresortstadoba/",
    "https://lotus-nano.com",
  ],
  address: {
    "@type": "PostalAddress",
    streetAddress: "Survey No. 306, Village Mudholi, Taluka Bhadravati",
    addressLocality: "Chandrapur",
    addressRegion: "Maharashtra",
    postalCode: "442906",
    addressCountry: "IN",
  },
  geo: {
    "@type": "GeoCoordinates",
    latitude: 20.25602486093492,
    longitude: 79.2847888101826,
  },
  telephone: ["+91-90226-80451"],
  email: "info@limban.com",
  priceRange: "₹15,000-₹45,000",
  currenciesAccepted: ["INR"],
  paymentAccepted: ["Cash", "Credit Card", "UPI", "Bank Transfer"],
  checkinTime: "13:00",
  checkoutTime: "11:00",
  numberOfRooms: rooms.length || 6,
  petsAllowed: false,
  smokingAllowed: false,
  starRating: {
    "@type": "Rating",
    ratingValue: 5,
  },
  aggregateRating: {
    "@type": "AggregateRating",
    ratingValue: 4.8,
    reviewCount: 127,
    bestRating: 5,
    worstRating: 1,
  },
  amenityFeature: [
    {
      "@type": "LocationFeatureSpecification",
      name: "Tiger Safari Tours",
      value: true,
    },
    {
      "@type": "LocationFeatureSpecification",
      name: "Eco-Luxury Accommodations",
      value: true,
    },
    {
      "@type": "LocationFeatureSpecification",
      name: "Wildlife Conservation Programs",
      value: true,
    },
    {
      "@type": "LocationFeatureSpecification",
      name: "Spa & Wellness Center",
      value: true,
    },
    {
      "@type": "LocationFeatureSpecification",
      name: "Restaurant & Bar",
      value: true,
    },
    {
      "@type": "LocationFeatureSpecification",
      name: "Swimming Pool",
      value: true,
    },
    { "@type": "LocationFeatureSpecification", name: "Free WiFi", value: true },
    {
      "@type": "LocationFeatureSpecification",
      name: "Airport Transfer",
      value: true,
    },
  ],
  makesOffer: [
    {
      "@type": "Offer",
      name: "Safari Package",
      description: "Tiger safari experience with luxury accommodation",
      priceCurrency: "INR",
      price: "25000",
    },
  ],
  hasMap:
    "https://www.google.com/maps/place/20.25602486093492,79.2847888101826",
  parentOrganization: {
    "@type": "Organization",
    name: "Lotus Nano",
    url: "https://lotus-nano.com",
  },
  award: [
    "TripAdvisor Travelers' Choice 2023",
    "Condé Nast Traveller Featured Property",
    "Outlook Traveller Hidden Gem 2022",
  ],
  knowsAbout: [
    "Tiger Conservation",
    "Sustainable Tourism",
    "Wildlife Photography",
    "Eco-Luxury Hospitality",
    "Tadoba Ecosystem",
  ],
};
---

<Layout
  title="Limban Resort | Award-Winning Eco-Luxury Tiger Safari Lodge in Tadoba National Park"
>
  <AstroSEO
    slot="head"
    title="Limban Resort | Award-Winning Eco-Luxury Tiger Safari Lodge in Tadoba National Park"
    description="Experience sustainable luxury at Limban Resort, Tadoba's premier eco-friendly safari lodge. Award-winning tiger safaris, conservation programs, and luxury accommodations in Maharashtra, India."
    canonical="https://limban.com"
    openGraph={{
      title:
        "Limban Resort - Award-Winning Eco-Luxury Safari Lodge | Tadoba National Park",
      description:
        "Discover India's premier eco-luxury safari experience at Limban Resort. Sustainable tiger safaris, conservation programs, and award-winning hospitality in Tadoba National Park, Maharashtra.",
      image: heroImage,
      type: "website",
      url: "https://limban.com",
      site_name: "Limban Resort",
    }}
    jsonLd={enhancedJsonLd}
  />

  <HeroSection heroes={heroes} />
  <SubHeroSection subHero={data.subHero} />
  <RoomsSection rooms={rooms} specialDeal={data.specialDeal} />
  <ExperiencesSection
    experiences={{
      aboveHeader: "Unique Experiences",
      title: "Beyond Accommodation",
      description:
        "Discover activities that connect you with nature and local culture",
      experience: services,
    }}
  />
  <TestimonialsSection />
  <AwardsSection />
  <ContactSection />
</Layout>
