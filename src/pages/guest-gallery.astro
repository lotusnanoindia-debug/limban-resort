---
import Layout from "../layouts/Layout.astro";
import { AstroSEO } from "astro-seo-plugin";
import UniversalGallery from "../components/UniversalGallery.astro";
import GalleryModal from "../components/GalleryModal.astro";
import imageService from "../utils/ImageService.js";
import { fetchAboutPage } from "../api.js";
import TestimonialsSection from "../components/TestimonialsSection.astro";

// Fetch guest gallery data
let aboutData = null;
try {
  aboutData = await fetchAboutPage();
} catch (err) {
  console.error("Failed to load guest gallery:", err);
  aboutData = { guestGallery: { images: [] } };
}

const guestGallery = aboutData?.guestGallery || { images: [] };

// Process hero tiles for mosaic (first 12 images)
const heroTiles =
  guestGallery.images && guestGallery.images.length > 0
    ? guestGallery.images.slice(0, 12).map((item, index) => {
        const imageData = item.image || item;

        return {
          src: imageService.processImage(imageData, "headerTile", {
            quality: 30,
          }),
          alt: imageData.alt || `Guest moment ${index + 1}`,
          width: 200,
          height: 200,
          caption: imageData.alt || `Guest Experience ${index + 1}`,
        };
      })
    : [];

// Hero image for SEO
const heroImageUrl =
  heroTiles[0]?.src ||
  (guestGallery.images?.[0]
    ? imageService.processImage(guestGallery.images[0], "heroDesktop", {
        quality: 60,
      })
    : "https://limban.com/img/guests-hero.avif");

// Schema images
const schemaImages = guestGallery.images
  .slice(0, 5)
  .map((item) => {
    const imageData = item.image || item;
    return imageService.processImage(imageData, "heroDesktop");
  })
  .filter(Boolean);
---

<Layout>
  <AstroSEO
    slot="head"
    title="Guest Gallery: Real Moments at Limban Resort"
    description="Explore photos submitted by our guests from over 20 countries. See the genuine smiles, real connections, and unforgettable safari experiences at Limban Resort, Tadoba."
    openGraph={{
      title: "Real Guests, Real Moments - Limban Resort",
      description:
        "See the genuine joy and connection our guests experience at Limban Resort. These are the faces of those who found what they were seeking.",
      image: heroImageUrl,
      type: "website",
      url: "https://limban.com/guest-gallery",
    }}
    jsonLd={{
      "@context": "https://schema.org",
      "@type": "ImageGallery",
      name: "Limban Resort Guest Gallery",
      description:
        "A collection of photos submitted by guests of Limban Resort, capturing their experiences with nature and hospitality in Tadoba.",
      url: "https://limban.com/guest-gallery",
      image: schemaImages,
    }}
  />

  <div class="bg-gray-950 text-gray-100 selection:bg-gray-700">
    <!-- Hero Section with Image Mosaic -->
    <section
      class="relative pt-48 pb-32 overflow-hidden bg-gray-950"
      role="banner"
      aria-labelledby="hero-heading"
    >
      <!-- Background Mosaic -->
      <div
        class="absolute inset-0 grid grid-cols-4 md:grid-cols-6 gap-0 opacity-50"
      >
        {
          heroTiles.map((image, index) => (
            <div
              key={`mosaic-${index}`}
              class="relative overflow-hidden h-full fade-in-up"
              style={`animation-delay: ${index * 80}ms`}
            >
              <img
                src={image.src}
                alt={image.alt}
                class="relative w-full h-full object-cover hover:scale-105 transition-all duration-1000"
                loading={index < 12 ? "eager" : "lazy"}
                fetchpriority={index < 6 ? "high" : "auto"}
                decoding="async"
                width={image.width}
                height={image.height}
              />

              <div class="absolute inset-0 bg-gray-900/80 opacity-0 hover:opacity-100 transition-opacity duration-300 flex items-center justify-center p-2">
                <span class="text-white text-xs font-light text-center line-clamp-2">
                  {image.caption}
                </span>
              </div>
            </div>
          ))
        }
      </div>

      <!-- Layered Gradients for Text Readability -->
      <div
        class="absolute inset-0 bg-gradient-to-br from-black/85 via-black/60 to-black/75"
      >
      </div>

      <!-- Hero Content -->
      <div class="relative z-10 max-w-5xl mx-auto px-6 text-center">
        <div
          class="text-sm text-amber-400/70 tracking-[0.2em] uppercase mb-6 font-light"
        >
          Guest Experiences
        </div>
        <h1
          id="hero-heading"
          class="font-serif text-5xl md:text-7xl lg:text-8xl text-white mb-8 drop-shadow-2xl leading-tight"
        >
          Guest Gallery<br />
          <span class="text-amber-400">Moments That Matter</span>
        </h1>
        <p
          class="text-lg md:text-xl text-gray-200 max-w-3xl mx-auto leading-relaxed drop-shadow-lg font-light"
        >
          Meet some of our guests from over 20 countries who found what they
          were looking for — real connection, raw nature, and genuine
          hospitality.
        </p>
      </div>
    </section>

    <!-- Breadcrumb Navigation -->
    <nav
      class="py-6 bg-gray-900/50 border-b border-gray-800"
      aria-label="Breadcrumb"
    >
      <div class="max-w-7xl mx-auto px-6">
        <ol class="flex items-center justify-center space-x-2 text-sm">
          <li>
            <a
              href="/"
              title="Return to Limban Resort homepage"
              class="text-gray-400 hover:text-amber-400 transition-colors duration-300 flex items-center"
            >
              <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path
                  d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"
                ></path>
              </svg>
              Home
            </a>
          </li>
          <li>
            <svg
              class="w-4 h-4 text-gray-600"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                clip-rule="evenodd"></path>
            </svg>
          </li>
          <li>
            <span class="text-amber-400 font-medium">Guest Gallery</span>
          </li>
        </ol>
      </div>
    </nav>

    <!-- Gallery Section - Using Standard UniversalGallery -->
    <section class="py-32 bg-gradient-to-b to-gray-1 from-gray-950/30">
      <div class="max-w-7xl mx-auto px-6">
        <UniversalGallery
          rawImages={guestGallery.images}
          galleryType="guest"
          initialCount={18}
          batchSize={12}
          columns={{
            mobile: 2,
            tablet: 3,
            desktop: 4,
            xl: 4,
          }}
          aspectRatio="square"
          showOverlay={true}
        />
      </div>
    </section>

    <TestimonialsSection />

    <!-- Share Your Photos Section -->
    <section class="py-24 bg-gray-0">
      <div class="max-w-3xl mx-auto px-6 text-center">
        <div
          class="inline-block px-6 py-2 bg-amber-400/10 border border-amber-400/30 rounded-full mb-8"
        >
          <span
            class="text-amber-400 text-sm font-medium tracking-widest uppercase"
          >
            Share Your Story
          </span>
        </div>

        <h2 class="font-serif text-3xl md:text-5xl text-white mb-6">
          Stayed with us?
        </h2>

        <p
          class="text-lg text-gray-300 font-light leading-relaxed mb-10 max-w-2xl mx-auto"
        >
          We'd love to see your favourite moments from Limban. Share your photos
          and videos, and become part of our story.
        </p>

        <!-- Upload Button -->
        <a
          href="https://forms.gle/uvrQyXgW1mbnABm59"
          target="_blank"
          rel="noopener noreferrer"
          title="Share your Limban photos and videos"
          class="group inline-flex items-center px-8 py-4 bg-blue-700 hover:bg-amber-500 text-white rounded-full transition-all duration-300 font-semibold shadow-lg hover:shadow-xl hover:scale-105"
        >
          <svg
            class="w-5 h-5 mr-3"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
            ></path>
          </svg>
          Upload Your Photos & Videos
        </a>

        <p class="text-sm text-gray-500 font-light mt-8">
          Upload up to 10 photos or videos—no sign-in required
        </p>
      </div>
    </section>

    <!-- Call to Action -->
    <section class="py-32 bg-gray-950">
      <div class="max-w-4xl mx-auto px-6 text-center">
        <h2 class="font-serif text-4xl md:text-6xl text-white mb-8">
          Not been to Limban yet?
        </h2>
        <p
          class="text-xl text-gray-300 font-light leading-relaxed mb-12 max-w-3xl mx-auto"
        >
          We look forward to welcoming you to your journey into the heart of
          Tadoba. Experience luxury that respects the wild, hospitality that
          touches the soul, and moments we guarantee you'll share with your
          loved ones.
        </p>
        <div class="flex flex-col sm:flex-row gap-6 justify-center">
          <a
            href="/rooms"
            title="Explore luxury safari accommodations at Limban Resort"
            class="cta-filled"
          >
            Explore Our Rooms
            <svg
              class="w-5 h-5 ml-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </a>
          <a
            href="/vibe"
            title="Discover the unique atmosphere and experiences at Limban Resort"
            class="cta-outlined"
          >
            The Limban Vibe
            <svg
              class="w-5 h-5 ml-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </a>
        </div>
      </div>
    </section>
  </div>

  <GalleryModal />

  <style>
    /* Fade-in animation for mosaic tiles */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in-up {
      animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      opacity: 0;
    }

    /* Performance optimizations */
    @media (prefers-reduced-motion: reduce) {
      .fade-in-up {
        animation: none !important;
        opacity: 1 !important;
      }
      * {
        transition: none !important;
      }
    }
  </style>
</Layout>
