---
export const prerender = true;
import Layout from "../layouts/Layout.astro";
import { AstroSEO } from "astro-seo-plugin";
import UniversalGallery from "../components/UniversalGallery.astro";
import GalleryModal from "../components/GalleryModal.astro";
import imageService from "../utils/ImageService.js";
import { fetchVibePage } from "../api.js";

// Helper for Cloudinary JPG (schema)
const toCloudinaryJpg = (url: string) => {
  if (!url) return "";
  return `https://res.cloudinary.com/dfa5hhzej/image/fetch/w_1200,h_675,c_fill,q_85,f_jpg/${url}`;
};

// Server-side data fetching with error handling
let vibeData = null;
try {
  vibeData = await fetchVibePage();
} catch (err) {
  console.error("Failed to load vibe data:", err);
  vibeData = {
    vibeImages: [],
    wildlifeImages: [],
  };
}

// Process vibe images
const processedVibeImages =
  vibeData?.vibeImages && vibeData.vibeImages.length > 0
    ? vibeData.vibeImages.map((item, index) => {
        const imageData = item.image || item;

        return {
          id: imageData.id,
          alt: imageData.alt || item.altText || `Image ${index + 1}`,
          width: imageData.width,
          height: imageData.height,
          processedUrls: {
            thumbnail: imageService.processImage(imageData, "galleryThumbnail"),
            gallery: imageService.processImage(imageData, "gallery"),
            large: imageService.processImage(imageData, "galleryModal"),
            modal: imageService.processImage(imageData, "heroDesktop"),
          },
        };
      })
    : [];

// Process wildlife images
const processedWildlifeImages =
  vibeData?.wildlifeImages && vibeData.wildlifeImages.length > 0
    ? vibeData.wildlifeImages.map((item, index) => {
        const imageData = item.image || item;

        return {
          id: imageData.id,
          alt: imageData.alt || item.alt || `Wildlife ${index + 1}`,
          width: imageData.width,
          height: imageData.height,
          processedUrls: {
            thumbnail: imageService.processImage(imageData, "galleryThumbnail"),
            gallery: imageService.processImage(imageData, "gallery"),
            large: imageService.processImage(imageData, "galleryModal"),
            modal: imageService.processImage(imageData, "heroDesktop"),
          },
        };
      })
    : [];

// Process hero tiles for mosaic
const heroTiles =
  vibeData?.vibeImages && vibeData.vibeImages.length > 0
    ? vibeData.vibeImages.slice(0, 12).map((item, index) => {
        const imageData = item.image || item;

        return {
          src: imageService.processImage(imageData, "heroTile", {
            quality: 60,
          }),
          alt:
            imageData.alt || item.altText || `Limban Experience ${index + 1}`,
          width: 300,
          height: 400,
          caption:
            imageData.alt || item.altText || `Limban Experience ${index + 1}`,
        };
      })
    : [];

// Hero image for display (AVIF)
const heroImageUrl =
  heroTiles[0]?.src ||
  (processedVibeImages[0]
    ? processedVibeImages[0].processedUrls.large
    : "https://limban.com/img/vibe-hero.avif");

// Schema image (JPG) with fallback
const heroImageSchema = vibeData?.vibeImages?.[0]?.image?.url
  ? toCloudinaryJpg(vibeData.vibeImages[0].image.url)
  : "https://res.cloudinary.com/dfa5hhzej/image/fetch/w_1200,h_675,c_fill,q_85,f_jpg/https://limban.com/img/vibe-hero.jpg";

// Simple schema for image gallery page
const vibePageSchema = {
  "@context": "https://schema.org",
  "@type": "ImageGallery",
  "@id": "https://limban.com/vibe#gallery",
  name: "The Limban Vibe - Experience Gallery",
  description:
    "Immerse yourself in the Limban experience. Feel the luxury, taste the wild, live the moment. This is what calls you to Tadoba.",
  url: "https://limban.com/vibe",
  image: heroImageSchema,
  about: {
    "@type": "Hotel",
    "@id": "https://limban.com/#hotel",
    name: "Limban Resort",
  },
};
---

<link rel="preload" as="image" href={heroImageUrl} fetchpriority="high" />

<Layout
  title="The Limban Vibe | Feel What Calls You Wild - Tadoba Safari Experience"
  description="Immerse yourself in the Limban experience. Feel the luxury, taste the wild, live the moment. This is what calls you to Tadoba."
  ogImage={heroImageSchema}
  ogImageWidth={1200}
  ogImageHeight={675}
  ogType="website"
  ogUrl="https://limban.com/vibe"
>
  <AstroSEO slot="head" jsonLd={vibePageSchema} />

  <div class="bg-gray-950 text-gray-100 selection:bg-amber-400/20">
    <!-- Skip to content for accessibility -->
    <a
      href="#main-content"
      title="Skip to main content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-amber-400 text-gray-900 px-4 py-2 rounded z-50"
    >
      Skip to main content
    </a>

    <!-- Hero Section with Image Mosaic -->
    <section
      class="relative pt-48 pb-32 overflow-hidden bg-gray-950"
      role="banner"
      aria-labelledby="hero-heading"
    >
      <!-- Background Mosaic -->
      <div
        class="absolute inset-0 grid grid-cols-4 md:grid-cols-6 gap-0 opacity-60"
      >
        {
          heroTiles.map((image, index) => (
            <div
              key={`mosaic-${index}`}
              class="relative overflow-hidden h-full fade-in-up"
              style={`animation-delay: ${index * 100}ms`}
            >
              <img
                src={image.src}
                alt={image.alt}
                class="relative w-full h-full object-cover hover:scale-105 transition-all duration-1000"
                loading={index < 12 ? "eager" : "lazy"}
                fetchpriority={index < 6 ? "high" : "auto"}
                decoding="async"
                width={image.width}
                height={image.height}
              />

              <div class="absolute inset-0 bg-gray-900/80 opacity-0 hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                <span class="text-white text-xs font-medium text-center px-2">
                  {image.caption || "Limban Experience"}
                </span>
              </div>
            </div>
          ))
        }
      </div>

      <!-- Layered Gradients for Perfect Text Readability -->
      <div
        class="absolute inset-0 bg-gradient-to-br from-black/80 via-black/50 to-black/70"
      >
      </div>

      <!-- Hero content -->
      <div class="relative z-10 max-w-7xl mx-auto px-6 text-center">
        <div
          class="text-sm text-gray-300 tracking-[0.2em] uppercase mb-6"
          role="doc-subtitle"
        >
          Luxury Wilderness Resort
        </div>
        <h1
          id="hero-heading"
          class="font-serif text-5xl md:text-7xl lg:text-8xl text-amber-400 mb-8 drop-shadow-2xl"
        >
          Feel The Vibe
        </h1>
        <p
          class="text-xl md:text-2xl text-gray-200 max-w-4xl mx-auto leading-relaxed drop-shadow-lg"
        >
          Sustainable luxury minutes away from Kuthwanda and Moharli Gate. Where
          passionate hosts, exceptional naturalists, and Tadoba's tigers create
          your perfect safari base.
        </p>
      </div>
    </section>

    <!-- Breadcrumb Navigation -->
    <nav
      class="py-6 bg-gray-900/50 border-b border-gray-800"
      aria-label="Breadcrumb"
    >
      <div class="max-w-7xl mx-auto px-6">
        <ol class="flex items-center justify-center space-x-2 text-sm">
          <li>
            <a
              href="/"
              title="Return to Limban Resort homepage"
              class="text-gray-400 hover:text-amber-400 transition-colors duration-300 flex items-center"
            >
              <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path
                  d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"
                ></path>
              </svg>
              Home
            </a>
          </li>
          <li>
            <svg
              class="w-4 h-4 text-gray-600"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                clip-rule="evenodd"></path>
            </svg>
          </li>
          <li>
            <span class="text-amber-400 font-medium">The Limban Vibe</span>
          </li>
        </ol>
      </div>
    </nav>

    <!-- Resort Vibe Section -->
    <section class="py-32 bg-gray-1" aria-labelledby="resort-heading">
      <div class="max-w-7xl mx-auto px-6">
        <header class="text-center mb-16">
          <div
            class="inline-block px-6 py-2 bg-amber-400/10 border border-amber-400/30 rounded-full mb-8"
          >
            <span
              class="text-amber-400 text-sm font-medium tracking-widest uppercase"
              >Visual Journey</span
            >
          </div>
          <h2
            id="resort-heading"
            class="font-serif text-4xl md:text-6xl text-white mb-6"
          >
            Live the Luxury.<br />
            <span class="text-amber-400">Feel the Soul.</span>
          </h2>
          <p class="text-xl text-gray-300 max-w-2xl mx-auto">
            Every corner whispers stories. Every moment breathes life. This is
            how luxury feels when it's crafted with soul.
          </p>
        </header>

        {
          processedVibeImages.length > 0 ? (
            <>
              <UniversalGallery
                rawImages={vibeData.vibeImages}
                galleryType="vibe"
                initialCount={12}
                aspectRatio="square"
              />
            </>
          ) : (
            <div class="text-center py-16">
              <p class="text-gray-400 text-lg">Gallery images coming soon...</p>
            </div>
          )
        }
      </div>
    </section>

    <!-- Transition Section -->
    <section class="py-20 bg-gray-0">
      <div class="max-w-4xl mx-auto text-center px-6">
        <h3 class="font-serif text-4xl md:text-5xl text-white mb-6">
          And then...
          <div class="text-amber-400 mt-3 lg:text-6xl text-5xl">
            The Wild Calls
          </div>
        </h3>
        <p class="text-xl text-gray-300 font-light leading-relaxed">
          Beyond the luxury, beyond the comfort, lies the reason you came here.
          The untamed. The magnificent. The wild heart of Tadoba.
        </p>
      </div>
    </section>

    <!-- Wildlife Gallery Section -->
    <section class="py-32 bg-gray-1" aria-labelledby="wildlife-heading">
      <div class="max-w-7xl mx-auto px-6">
        <header class="text-center mb-16">
          <div
            class="inline-block px-6 py-2 bg-green-400/10 border border-green-400/30 rounded-full mb-8"
          >
            <span
              class="text-green-400 text-sm font-medium tracking-widest uppercase"
              >Visual Journey</span
            >
          </div>
          <h2
            id="wildlife-heading"
            class="font-serif text-4xl md:text-6xl text-white mb-6"
          >
            Meet Your<br />
            <div class="text-green-400 mt-3 lg:text-6xl text-5xl">
              Wild Neighbours
            </div>
          </h2>
          <p class="text-xl text-gray-300 max-w-2xl mx-auto">
            In Tadoba, you're not just a visitor — you're a guest in their
            ancient kingdom. These are the moments that change you forever.
          </p>
        </header>

        {
          processedWildlifeImages.length > 0 ? (
            <>
              <UniversalGallery
                rawImages={vibeData.wildlifeImages}
                galleryType="wildlife"
                initialCount={12}
                aspectRatio="square"
              />
            </>
          ) : (
            <div class="text-center py-16">
              <p class="text-gray-400 text-lg">
                Wildlife gallery coming soon...
              </p>
            </div>
          )
        }
      </div>
    </section>

    <!-- Call to Action -->
    <section class="py-32 bg-gray-0">
      <div class="max-w-5xl mx-auto px-6 text-center">
        <h2 class="font-serif text-5xl md:text-7xl text-white mb-8">
          Ready to Experience
          <span class="block text-amber-400">The Limban Vibe?</span>
        </h2>
        <p
          class="text-2xl text-gray-300 font-light leading-relaxed mb-12 max-w-4xl mx-auto"
        >
          Every image tells its own story. Your story begins the moment you
          arrive. The wild is calling. Limban is waiting.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/rooms" class="cta-filled">Reserve Your Stay</a>
          <a href="/safaris" class="cta-outlined">Learn about Safaris</a>
        </div>
      </div>
    </section>
  </div>

  <GalleryModal />
</Layout>

<style>
  .fade-in-up {
    opacity: 0;
    animation: fadeInUp 1s ease-out forwards;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .transition-transform {
    will-change: transform;
  }

  /* Respect user motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .transition-all,
    .transition-transform,
    .transition-colors,
    .hover\:scale-105,
    .hover\:scale-110,
    .animate-pulse {
      transition: none !important;
      transform: none !important;
      animation: none !important;
    }
  }
</style>
